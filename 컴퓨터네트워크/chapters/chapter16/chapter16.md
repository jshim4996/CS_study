# Chapter 16. Web Performance Optimization (웹 성능 최적화)

---

## Table of Contents (목차)

1. [HTTP Caching (HTTP 캐싱)](#1-http-caching-http-캐싱)
2. [CDN Concept and Operation (CDN 개념과 동작)](#2-cdn-concept-and-operation-cdn-개념과-동작)
3. [Compression (압축)](#3-compression-압축)
4. [Connection Pooling (연결 풀링)](#4-connection-pooling-연결-풀링)
5. [Summary (요약)](#5-summary-요약)

---

## 1. HTTP Caching (HTTP 캐싱)

### Why Caching Matters (캐싱이 중요한 이유)

```
+-----------------------------------------------------------------------+
|                    Without Caching                                     |
+-----------------------------------------------------------------------+
|                                                                       |
|   User visits page 3 times:                                           |
|   사용자가 페이지를 3번 방문:                                         |
|                                                                       |
|   Visit 1: [Browser] ----GET logo.png----> [Server] (200 OK, 100KB)   |
|   Visit 2: [Browser] ----GET logo.png----> [Server] (200 OK, 100KB)   |
|   Visit 3: [Browser] ----GET logo.png----> [Server] (200 OK, 100KB)   |
|                                                                       |
|   Total: 300KB transferred, 3 server requests                         |
|   총: 300KB 전송, 서버 요청 3회                                       |
|                                                                       |
+-----------------------------------------------------------------------+

+-----------------------------------------------------------------------+
|                    With Caching                                        |
+-----------------------------------------------------------------------+
|                                                                       |
|   Visit 1: [Browser] ----GET logo.png----> [Server] (200 OK, 100KB)   |
|            [Browser] <--- Cache locally                               |
|                                                                       |
|   Visit 2: [Browser] <--- Read from cache (instant!)                  |
|                                                                       |
|   Visit 3: [Browser] <--- Read from cache (instant!)                  |
|                                                                       |
|   Total: 100KB transferred, 1 server request                          |
|   총: 100KB 전송, 서버 요청 1회                                       |
|                                                                       |
|   Benefits: Faster load time, less bandwidth, reduced server load     |
|   장점: 더 빠른 로드 시간, 적은 대역폭, 서버 부하 감소                |
|                                                                       |
+-----------------------------------------------------------------------+
```

### Caching Layers (캐싱 계층)

```
+-----------------------------------------------------------------------+
|                    Caching Hierarchy                                   |
+-----------------------------------------------------------------------+
|                                                                       |
|   User Request                                                        |
|        |                                                              |
|        v                                                              |
|   +----------------+                                                  |
|   | Browser Cache  |  <-- Fastest, on user's device                   |
|   | 브라우저 캐시  |      가장 빠름, 사용자 기기에 있음               |
|   +----------------+                                                  |
|        | Miss                                                         |
|        v                                                              |
|   +----------------+                                                  |
|   | CDN Cache      |  <-- Edge servers worldwide                      |
|   | CDN 캐시       |      전 세계 엣지 서버                           |
|   +----------------+                                                  |
|        | Miss                                                         |
|        v                                                              |
|   +----------------+                                                  |
|   | Proxy Cache    |  <-- ISP or corporate proxy                      |
|   | 프록시 캐시    |      ISP 또는 기업 프록시                        |
|   +----------------+                                                  |
|        | Miss                                                         |
|        v                                                              |
|   +----------------+                                                  |
|   | Origin Server  |  <-- Your web server                             |
|   | 원본 서버      |      웹 서버                                     |
|   +----------------+                                                  |
|                                                                       |
+-----------------------------------------------------------------------+
```

### Cache-Control Header (Cache-Control 헤더)

```
+-----------------------------------------------------------------------+
|                    Cache-Control Directives                            |
+-----------------------------------------------------------------------+
|                                                                       |
|   Response Header:                                                    |
|   Cache-Control: max-age=3600, public                                 |
|                  ^            ^                                       |
|                  |            |                                       |
|           Cache for 1 hour   Can be cached by anyone                  |
|           1시간 동안 캐시    누구나 캐시 가능                          |
|                                                                       |
+-----------------------------------------------------------------------+

+----------------------+------------------------------------------------+
| Directive            | Description                                    |
+----------------------+------------------------------------------------+
| max-age=<seconds>    | How long to cache (in seconds)                 |
|                      | 캐시 유지 시간 (초 단위)                       |
+----------------------+------------------------------------------------+
| public               | Can be cached by browser, CDN, proxy           |
|                      | 브라우저, CDN, 프록시가 캐시 가능              |
+----------------------+------------------------------------------------+
| private              | Only browser can cache (not CDN/proxy)         |
|                      | 브라우저만 캐시 가능 (CDN/프록시 불가)         |
+----------------------+------------------------------------------------+
| no-cache             | Must revalidate with server before using       |
|                      | 사용 전 서버와 재검증 필수                     |
+----------------------+------------------------------------------------+
| no-store             | Never cache (sensitive data)                   |
|                      | 절대 캐시하지 않음 (민감한 데이터)             |
+----------------------+------------------------------------------------+
| must-revalidate      | Must check if stale before using               |
|                      | 사용 전 만료 여부 확인 필수                    |
+----------------------+------------------------------------------------+
| immutable            | Resource will never change                     |
|                      | 리소스가 절대 변경되지 않음                    |
+----------------------+------------------------------------------------+
| s-maxage=<seconds>   | max-age for shared caches (CDN)                |
|                      | 공유 캐시(CDN)용 max-age                       |
+----------------------+------------------------------------------------+
```

### Cache-Control Examples (Cache-Control 예시)

```
+-----------------------------------------------------------------------+
|                    Common Cache-Control Patterns                       |
+-----------------------------------------------------------------------+
|                                                                       |
|   1. Static assets with versioned URLs (버전이 있는 정적 자산):       |
|   +---------------------------------------------------------------+   |
|   | File: /static/app.v1234.js                                    |   |
|   | Cache-Control: public, max-age=31536000, immutable            |   |
|   |                                                               |   |
|   | Cache for 1 year - URL changes when content changes           |   |
|   | 1년 캐시 - 내용 변경 시 URL이 변경됨                          |   |
|   +---------------------------------------------------------------+   |
|                                                                       |
|   2. Frequently updated content (자주 업데이트되는 콘텐츠):           |
|   +---------------------------------------------------------------+   |
|   | File: /api/news                                               |   |
|   | Cache-Control: public, max-age=60                             |   |
|   |                                                               |   |
|   | Cache for 1 minute                                            |   |
|   | 1분 캐시                                                      |   |
|   +---------------------------------------------------------------+   |
|                                                                       |
|   3. User-specific data (사용자별 데이터):                            |
|   +---------------------------------------------------------------+   |
|   | File: /api/user/profile                                       |   |
|   | Cache-Control: private, max-age=300                           |   |
|   |                                                               |   |
|   | Only browser cache, 5 minutes                                 |   |
|   | 브라우저만 캐시, 5분                                          |   |
|   +---------------------------------------------------------------+   |
|                                                                       |
|   4. Sensitive data (민감한 데이터):                                  |
|   +---------------------------------------------------------------+   |
|   | File: /api/bank/balance                                       |   |
|   | Cache-Control: no-store                                       |   |
|   |                                                               |   |
|   | Never cache anywhere                                          |   |
|   | 어디에도 캐시하지 않음                                        |   |
|   +---------------------------------------------------------------+   |
|                                                                       |
|   5. HTML pages that may change (변경될 수 있는 HTML 페이지):         |
|   +---------------------------------------------------------------+   |
|   | File: /index.html                                             |   |
|   | Cache-Control: no-cache                                       |   |
|   |                                                               |   |
|   | Always revalidate before using                                |   |
|   | 사용 전 항상 재검증                                           |   |
|   +---------------------------------------------------------------+   |
|                                                                       |
+-----------------------------------------------------------------------+
```

### ETag (Entity Tag) (ETag - 엔티티 태그)

```
+-----------------------------------------------------------------------+
|                    ETag Validation Flow                                |
+-----------------------------------------------------------------------+
|                                                                       |
|   Step 1: Initial Request (첫 번째 요청)                              |
|   +---------------------------------------------------------------+   |
|   | Client                              Server                    |   |
|   |    |  GET /logo.png                    |                      |   |
|   |    | --------------------------------> |                      |   |
|   |    |                                   |                      |   |
|   |    |  200 OK                           |                      |   |
|   |    |  ETag: "abc123"                   |                      |   |
|   |    |  [image data]                     |                      |   |
|   |    | <-------------------------------- |                      |   |
|   |    |                                   |                      |   |
|   |    | [Store in cache with ETag]        |                      |   |
|   +---------------------------------------------------------------+   |
|                                                                       |
|   Step 2: Subsequent Request (이후 요청)                              |
|   +---------------------------------------------------------------+   |
|   | Client                              Server                    |   |
|   |    |  GET /logo.png                    |                      |   |
|   |    |  If-None-Match: "abc123"          |                      |   |
|   |    | --------------------------------> |                      |   |
|   |    |                                   |                      |   |
|   |    | [Server checks: Is ETag same?]    |                      |   |
|   |    |                                   |                      |   |
|   +---------------------------------------------------------------+   |
|                                                                       |
|   Case A: Resource unchanged (리소스 변경 없음)                       |
|   +---------------------------------------------------------------+   |
|   |    |  304 Not Modified (no body!)      |                      |   |
|   |    | <-------------------------------- |                      |   |
|   |    |                                   |                      |   |
|   |    | [Use cached version]              |                      |   |
|   |    | Saves bandwidth!                  |                      |   |
|   +---------------------------------------------------------------+   |
|                                                                       |
|   Case B: Resource changed (리소스 변경됨)                            |
|   +---------------------------------------------------------------+   |
|   |    |  200 OK                           |                      |   |
|   |    |  ETag: "def456" (new)             |                      |   |
|   |    |  [new image data]                 |                      |   |
|   |    | <-------------------------------- |                      |   |
|   |    |                                   |                      |   |
|   |    | [Update cache with new ETag]      |                      |   |
|   +---------------------------------------------------------------+   |
|                                                                       |
+-----------------------------------------------------------------------+
```

### Last-Modified vs ETag (Last-Modified vs ETag)

```
+----------------------+------------------------+------------------------+
| Feature              | Last-Modified          | ETag                   |
+----------------------+------------------------+------------------------+
| Validation Header    | If-Modified-Since      | If-None-Match          |
| 검증 헤더            |                        |                        |
+----------------------+------------------------+------------------------+
| Precision            | 1 second               | Exact (hash-based)     |
| 정밀도               | 1초                    | 정확함 (해시 기반)     |
+----------------------+------------------------+------------------------+
| Use Case             | Static files           | Any content            |
| 용도                 | 정적 파일              | 모든 콘텐츠            |
+----------------------+------------------------+------------------------+
| Generation           | File modification time | Content hash, version  |
| 생성                 | 파일 수정 시간         | 콘텐츠 해시, 버전      |
+----------------------+------------------------+------------------------+

Example:
+-----------------------------------------------------------------------+
| Last-Modified: Tue, 15 Jan 2024 12:00:00 GMT                          |
| If-Modified-Since: Tue, 15 Jan 2024 12:00:00 GMT                      |
|                                                                       |
| ETag: "33a64df551425fcc55e4d42a148795d9f25f89d4"                       |
| If-None-Match: "33a64df551425fcc55e4d42a148795d9f25f89d4"              |
+-----------------------------------------------------------------------+
```

### Cache Invalidation Strategies (캐시 무효화 전략)

```
+-----------------------------------------------------------------------+
|                    Cache Busting Strategies                            |
+-----------------------------------------------------------------------+
|                                                                       |
|   Problem: How to update cached content?                              |
|   문제: 캐시된 콘텐츠를 어떻게 업데이트할까?                          |
|                                                                       |
|   Strategy 1: Versioned URLs (버전이 있는 URL)                        |
|   +---------------------------------------------------------------+   |
|   | Before: /css/style.css                                        |   |
|   | After:  /css/style.v2.css  or  /css/style.css?v=2             |   |
|   |                                                               |   |
|   | Pros: Instant update, long cache times                        |   |
|   | Cons: Requires build process                                  |   |
|   +---------------------------------------------------------------+   |
|                                                                       |
|   Strategy 2: Content Hash in Filename (파일명에 콘텐츠 해시)         |
|   +---------------------------------------------------------------+   |
|   | style.a1b2c3d4.css                                            |   |
|   |       ^                                                       |   |
|   |       Hash of file content                                    |   |
|   |       파일 콘텐츠의 해시                                      |   |
|   |                                                               |   |
|   | Most reliable - filename changes only when content changes    |   |
|   | 가장 신뢰할 수 있음 - 콘텐츠 변경 시에만 파일명 변경          |   |
|   +---------------------------------------------------------------+   |
|                                                                       |
|   Strategy 3: Short max-age with revalidation (짧은 max-age + 재검증) |
|   +---------------------------------------------------------------+   |
|   | Cache-Control: max-age=60                                     |   |
|   | ETag: "abc123"                                                |   |
|   |                                                               |   |
|   | Cache for 1 minute, then revalidate                           |   |
|   | 1분 캐시 후 재검증                                            |   |
|   +---------------------------------------------------------------+   |
|                                                                       |
+-----------------------------------------------------------------------+
```

---

## 2. CDN Concept and Operation (CDN 개념과 동작)

### What is a CDN? (CDN이란?)

A CDN (Content Delivery Network) is a geographically distributed network of servers that delivers content from locations closer to users.

CDN(콘텐츠 전송 네트워크)은 사용자와 가까운 위치에서 콘텐츠를 전달하는 지리적으로 분산된 서버 네트워크입니다.

```
+-----------------------------------------------------------------------+
|                    Without CDN                                         |
+-----------------------------------------------------------------------+
|                                                                       |
|                      [Origin Server in USA]                           |
|                              |                                        |
|          +-------------------+-------------------+                    |
|          |                   |                   |                    |
|     [User in USA]      [User in Europe]    [User in Asia]             |
|      50ms latency       150ms latency       300ms latency             |
|                                                                       |
|   Asian user experiences 6x slower response than US user!             |
|   아시아 사용자는 미국 사용자보다 6배 느린 응답 경험!                 |
|                                                                       |
+-----------------------------------------------------------------------+

+-----------------------------------------------------------------------+
|                    With CDN                                            |
+-----------------------------------------------------------------------+
|                                                                       |
|                      [Origin Server in USA]                           |
|                              |                                        |
|          +-------------------+-------------------+                    |
|          |                   |                   |                    |
|     [CDN Edge USA]     [CDN Edge Europe]   [CDN Edge Asia]            |
|          |                   |                   |                    |
|     [User in USA]      [User in Europe]    [User in Asia]             |
|      20ms latency        30ms latency        25ms latency             |
|                                                                       |
|   All users get fast, consistent experience!                          |
|   모든 사용자가 빠르고 일관된 경험!                                   |
|                                                                       |
+-----------------------------------------------------------------------+
```

### CDN Architecture (CDN 아키텍처)

```
+-----------------------------------------------------------------------+
|                    CDN Architecture                                    |
+-----------------------------------------------------------------------+
|                                                                       |
|                     +----------------+                                |
|                     | Origin Server  |  Your actual server            |
|                     | (웹 서버)      |  실제 서버                     |
|                     +-------+--------+                                |
|                             |                                         |
|              +--------------+--------------+                          |
|              |              |              |                          |
|              v              v              v                          |
|   +----------------+ +----------------+ +----------------+            |
|   | PoP Americas   | | PoP Europe     | | PoP Asia       |            |
|   | (Point of      | | (엣지 서버)   | | (엣지 서버)   |            |
|   |  Presence)     | |               | |               |            |
|   +----------------+ +----------------+ +----------------+            |
|         |                  |                  |                       |
|   +-----+-----+      +-----+-----+      +-----+-----+                 |
|   |     |     |      |     |     |      |     |     |                 |
|   v     v     v      v     v     v      v     v     v                 |
|  [US]  [BR] [MX]   [UK]  [DE] [FR]   [JP]  [KR] [SG]                  |
|  Users Users Users Users Users Users Users Users Users                |
|                                                                       |
|   PoP = Point of Presence (edge location)                             |
|   PoP = 접속 지점 (엣지 위치)                                         |
|                                                                       |
+-----------------------------------------------------------------------+
```

### How CDN Works (CDN 동작 방식)

```
+-----------------------------------------------------------------------+
|                    CDN Request Flow                                    |
+-----------------------------------------------------------------------+
|                                                                       |
|   Step 1: User requests content                                       |
|   +---------------------------------------------------------------+   |
|   | User in Korea requests: https://cdn.example.com/image.jpg     |   |
|   |                                                               |   |
|   | 1. DNS lookup for cdn.example.com                             |   |
|   | 2. CDN DNS returns IP of nearest edge server (Seoul)          |   |
|   +---------------------------------------------------------------+   |
|                                                                       |
|   Step 2: Cache HIT (캐시 적중)                                       |
|   +---------------------------------------------------------------+   |
|   | If edge server has cached content:                            |   |
|   | 엣지 서버에 캐시된 콘텐츠가 있으면:                           |   |
|   |                                                               |   |
|   |   User <----[image.jpg]---- Seoul Edge Server                 |   |
|   |                                                               |   |
|   |   Fast! No origin server needed                               |   |
|   |   빠름! 원본 서버 불필요                                      |   |
|   +---------------------------------------------------------------+   |
|                                                                       |
|   Step 3: Cache MISS (캐시 미스)                                      |
|   +---------------------------------------------------------------+   |
|   | If edge server doesn't have content:                          |   |
|   | 엣지 서버에 콘텐츠가 없으면:                                  |   |
|   |                                                               |   |
|   |   User ---- Seoul Edge ---- Origin Server (USA)               |   |
|   |              |                    |                           |   |
|   |              | Request content    |                           |   |
|   |              | -----------------> |                           |   |
|   |              |                    |                           |   |
|   |              | <-[image.jpg]--    |                           |   |
|   |              |                    |                           |   |
|   |              | Store in cache     |                           |   |
|   |              |                    |                           |   |
|   |   User <----[image.jpg]----       |                           |   |
|   |                                                               |   |
|   |   Next user in Korea gets cached version!                     |   |
|   |   다음 한국 사용자는 캐시된 버전을 받음!                      |   |
|   +---------------------------------------------------------------+   |
|                                                                       |
+-----------------------------------------------------------------------+
```

### CDN Benefits (CDN 장점)

```
+-----------------------------------------------------------------------+
|                    CDN Benefits                                        |
+-----------------------------------------------------------------------+
|                                                                       |
|   +----------------------------+-------------------------------------+|
|   | Benefit                    | Description                         ||
|   +----------------------------+-------------------------------------+|
|   | Reduced Latency            | Content served from nearby servers  ||
|   | 지연 시간 감소             | 가까운 서버에서 콘텐츠 제공         ||
|   +----------------------------+-------------------------------------+|
|   | Reduced Bandwidth Cost     | Less traffic to origin server       ||
|   | 대역폭 비용 절감           | 원본 서버로의 트래픽 감소           ||
|   +----------------------------+-------------------------------------+|
|   | Improved Availability      | If one edge fails, others serve     ||
|   | 가용성 향상                | 하나의 엣지가 실패해도 다른 것이 제공||
|   +----------------------------+-------------------------------------+|
|   | DDoS Protection            | Distributed network absorbs attacks ||
|   | DDoS 방어                  | 분산 네트워크가 공격 흡수           ||
|   +----------------------------+-------------------------------------+|
|   | Scalability                | Handle traffic spikes easily        ||
|   | 확장성                     | 트래픽 급증 쉽게 처리               ||
|   +----------------------------+-------------------------------------+|
|   | SSL/TLS Offloading         | Edge handles TLS termination        ||
|   | SSL/TLS 오프로딩           | 엣지가 TLS 종료 처리                ||
|   +----------------------------+-------------------------------------+|
|                                                                       |
+-----------------------------------------------------------------------+
```

### Popular CDN Providers (주요 CDN 제공업체)

```
+-----------------------------------------------------------------------+
|                    Major CDN Providers                                 |
+-----------------------------------------------------------------------+
|                                                                       |
|   +------------------+------------------------------------------+     |
|   | Provider         | Notes                                    |     |
|   +------------------+------------------------------------------+     |
|   | Cloudflare       | Free tier available, DDoS protection     |     |
|   |                  | 무료 티어, DDoS 방어                     |     |
|   +------------------+------------------------------------------+     |
|   | AWS CloudFront   | Integrated with AWS services             |     |
|   |                  | AWS 서비스와 통합                        |     |
|   +------------------+------------------------------------------+     |
|   | Akamai           | Enterprise-grade, largest network        |     |
|   |                  | 엔터프라이즈급, 최대 네트워크            |     |
|   +------------------+------------------------------------------+     |
|   | Fastly           | Real-time purging, edge computing        |     |
|   |                  | 실시간 퍼지, 엣지 컴퓨팅                 |     |
|   +------------------+------------------------------------------+     |
|   | Google Cloud CDN | Integrated with GCP                      |     |
|   |                  | GCP와 통합                               |     |
|   +------------------+------------------------------------------+     |
|                                                                       |
+-----------------------------------------------------------------------+
```

---

## 3. Compression (압축)

### Why Compress? (왜 압축하는가?)

```
+-----------------------------------------------------------------------+
|                    Compression Impact                                  |
+-----------------------------------------------------------------------+
|                                                                       |
|   Without compression (압축 없이):                                    |
|   +---------------------------------------------------------------+   |
|   | Original HTML: 100 KB                                         |   |
|   | Transfer time (10 Mbps): ~80ms                                |   |
|   +---------------------------------------------------------------+   |
|                                                                       |
|   With compression (압축 후):                                         |
|   +---------------------------------------------------------------+   |
|   | Compressed HTML: 20 KB (80% reduction!)                       |   |
|   | Transfer time (10 Mbps): ~16ms                                |   |
|   +---------------------------------------------------------------+   |
|                                                                       |
|   Compression is especially effective for:                            |
|   압축이 특히 효과적인 것:                                            |
|   - HTML, CSS, JavaScript (text-based)                                |
|   - JSON, XML (API responses)                                         |
|   - SVG images                                                        |
|                                                                       |
|   Less effective for:                                                 |
|   덜 효과적인 것:                                                     |
|   - Images (JPEG, PNG - already compressed)                           |
|   - Videos (MP4 - already compressed)                                 |
|   - Encrypted content                                                 |
|                                                                       |
+-----------------------------------------------------------------------+
```

### gzip Compression (gzip 압축)

```
+-----------------------------------------------------------------------+
|                    gzip Overview                                       |
+-----------------------------------------------------------------------+
|                                                                       |
|   - Most widely supported compression                                 |
|   - 가장 널리 지원되는 압축                                           |
|                                                                       |
|   - Uses DEFLATE algorithm (LZ77 + Huffman coding)                    |
|   - DEFLATE 알고리즘 사용 (LZ77 + 허프만 코딩)                        |
|                                                                       |
|   - Compression levels: 1-9 (higher = better compression, slower)     |
|   - 압축 레벨: 1-9 (높을수록 = 더 좋은 압축, 더 느림)                 |
|                                                                       |
|   HTTP Request:                                                       |
|   +---------------------------------------------------------------+   |
|   | GET /page.html HTTP/1.1                                       |   |
|   | Host: example.com                                             |   |
|   | Accept-Encoding: gzip, deflate, br                            |   |
|   |                  ^                                            |   |
|   |                  Client tells server what it supports         |   |
|   |                  클라이언트가 지원 가능한 것을 서버에 알림    |   |
|   +---------------------------------------------------------------+   |
|                                                                       |
|   HTTP Response:                                                      |
|   +---------------------------------------------------------------+   |
|   | HTTP/1.1 200 OK                                               |   |
|   | Content-Encoding: gzip                                        |   |
|   |                   ^                                           |   |
|   |                   Server tells client compression used        |   |
|   |                   서버가 사용한 압축을 클라이언트에 알림      |   |
|   | Content-Length: 5432                                          |   |
|   |                                                               |   |
|   | [compressed body]                                             |   |
|   +---------------------------------------------------------------+   |
|                                                                       |
+-----------------------------------------------------------------------+
```

### Brotli Compression (Brotli 압축)

```
+-----------------------------------------------------------------------+
|                    Brotli Overview                                     |
+-----------------------------------------------------------------------+
|                                                                       |
|   - Developed by Google (2015)                                        |
|   - Google이 개발 (2015년)                                            |
|                                                                       |
|   - Better compression ratio than gzip (15-25% smaller)               |
|   - gzip보다 더 좋은 압축률 (15-25% 더 작음)                          |
|                                                                       |
|   - Widely supported by modern browsers                               |
|   - 현대 브라우저에서 널리 지원                                       |
|                                                                       |
|   - Compression levels: 0-11                                          |
|   - 압축 레벨: 0-11                                                   |
|                                                                       |
|   Content-Encoding: br                                                |
|                                                                       |
+-----------------------------------------------------------------------+

Comparison (비교):
+------------------+------------------+------------------+
| Metric           | gzip             | Brotli           |
+------------------+------------------+------------------+
| Compression Ratio| Good             | Better (15-25%)  |
| 압축률           | 좋음             | 더 좋음          |
+------------------+------------------+------------------+
| Speed (Compress) | Faster           | Slower           |
| 속도 (압축)      | 더 빠름          | 더 느림          |
+------------------+------------------+------------------+
| Speed (Decompress)| Fast            | Fast             |
| 속도 (해제)      | 빠름             | 빠름             |
+------------------+------------------+------------------+
| Browser Support  | Universal        | Modern browsers  |
| 브라우저 지원    | 모든 브라우저    | 현대 브라우저    |
+------------------+------------------+------------------+
| Best For         | Dynamic content  | Static assets    |
| 적합한 용도      | 동적 콘텐츠      | 정적 자산        |
+------------------+------------------+------------------+
```

### Compression Strategy (압축 전략)

```
+-----------------------------------------------------------------------+
|                    Compression Best Practices                          |
+-----------------------------------------------------------------------+
|                                                                       |
|   1. Pre-compress static assets (정적 자산 사전 압축)                 |
|   +---------------------------------------------------------------+   |
|   |   Build time: Compress files with Brotli (high level)         |   |
|   |   빌드 시: 브로틀리로 파일 압축 (높은 레벨)                   |   |
|   |                                                               |   |
|   |   app.js       --> app.js.gz (gzip)                           |   |
|   |                --> app.js.br (brotli)                         |   |
|   |                                                               |   |
|   |   Server serves pre-compressed files (no CPU overhead)        |   |
|   |   서버가 사전 압축된 파일 제공 (CPU 오버헤드 없음)            |   |
|   +---------------------------------------------------------------+   |
|                                                                       |
|   2. On-the-fly compression for dynamic content (동적 콘텐츠 실시간 압축)
|   +---------------------------------------------------------------+   |
|   |   Use lower compression level for speed                       |   |
|   |   속도를 위해 낮은 압축 레벨 사용                             |   |
|   |                                                               |   |
|   |   gzip level 4-6 is usually optimal                           |   |
|   |   gzip 레벨 4-6이 보통 최적                                   |   |
|   +---------------------------------------------------------------+   |
|                                                                       |
|   3. Don't compress already compressed content                        |
|   +---------------------------------------------------------------+   |
|   |   Skip: JPEG, PNG, WebP, MP4, ZIP, etc.                       |   |
|   |   건너뛰기: JPEG, PNG, WebP, MP4, ZIP 등                      |   |
|   |                                                               |   |
|   |   Wastes CPU with minimal benefit                             |   |
|   |   최소한의 이점으로 CPU 낭비                                  |   |
|   +---------------------------------------------------------------+   |
|                                                                       |
|   4. Set minimum size threshold (최소 크기 임계값 설정)               |
|   +---------------------------------------------------------------+   |
|   |   Don't compress files < 1KB                                  |   |
|   |   1KB 미만 파일은 압축하지 않음                               |   |
|   |                                                               |   |
|   |   Compression overhead may exceed savings                     |   |
|   |   압축 오버헤드가 절약보다 클 수 있음                         |   |
|   +---------------------------------------------------------------+   |
|                                                                       |
+-----------------------------------------------------------------------+
```

### Nginx Compression Configuration (Nginx 압축 설정)

```
+-----------------------------------------------------------------------+
|                    Nginx gzip Configuration                            |
+-----------------------------------------------------------------------+
|                                                                       |
|   # Enable gzip                                                       |
|   gzip on;                                                            |
|   gzip_vary on;                                                       |
|   gzip_proxied any;                                                   |
|   gzip_comp_level 6;                                                  |
|   gzip_min_length 1000;                                               |
|                                                                       |
|   # MIME types to compress                                            |
|   gzip_types                                                          |
|       text/plain                                                      |
|       text/css                                                        |
|       text/javascript                                                 |
|       application/javascript                                          |
|       application/json                                                |
|       application/xml                                                 |
|       image/svg+xml;                                                  |
|                                                                       |
|   # Brotli (if module installed)                                      |
|   brotli on;                                                          |
|   brotli_comp_level 6;                                                |
|   brotli_types text/plain text/css application/javascript;            |
|                                                                       |
+-----------------------------------------------------------------------+
```

---

## 4. Connection Pooling (연결 풀링)

### What is Connection Pooling? (연결 풀링이란?)

Connection pooling maintains a cache of database or HTTP connections that can be reused, avoiding the overhead of establishing new connections.

연결 풀링은 재사용 가능한 데이터베이스 또는 HTTP 연결의 캐시를 유지하여 새 연결을 설정하는 오버헤드를 피합니다.

```
+-----------------------------------------------------------------------+
|                    Without Connection Pooling                          |
+-----------------------------------------------------------------------+
|                                                                       |
|   Request 1: [Create Conn] --> [Execute] --> [Close Conn]             |
|   Request 2: [Create Conn] --> [Execute] --> [Close Conn]             |
|   Request 3: [Create Conn] --> [Execute] --> [Close Conn]             |
|                                                                       |
|   Each connection: TCP handshake + TLS handshake (if HTTPS)           |
|   각 연결: TCP 핸드셰이크 + TLS 핸드셰이크 (HTTPS인 경우)             |
|                                                                       |
|   Overhead: ~100-300ms per connection                                 |
|   오버헤드: 연결당 약 100-300ms                                       |
|                                                                       |
+-----------------------------------------------------------------------+

+-----------------------------------------------------------------------+
|                    With Connection Pooling                             |
+-----------------------------------------------------------------------+
|                                                                       |
|   +------------------------+                                          |
|   |    Connection Pool     |                                          |
|   |  +---+ +---+ +---+     |                                          |
|   |  |C1 | |C2 | |C3 | ... |  Pre-established connections             |
|   |  +---+ +---+ +---+     |  미리 설정된 연결                        |
|   +------------------------+                                          |
|              |                                                        |
|   Request 1: [Borrow C1] --> [Execute] --> [Return C1]                |
|   Request 2: [Borrow C2] --> [Execute] --> [Return C2]                |
|   Request 3: [Borrow C1] --> [Execute] --> [Return C1]                |
|                                                                       |
|   No connection overhead! Much faster!                                |
|   연결 오버헤드 없음! 훨씬 빠름!                                      |
|                                                                       |
+-----------------------------------------------------------------------+
```

### HTTP Connection Pooling (HTTP 연결 풀링)

```
+-----------------------------------------------------------------------+
|                    HTTP Keep-Alive Connection Pool                     |
+-----------------------------------------------------------------------+
|                                                                       |
|   Browser keeps connections open to servers (HTTP/1.1 default)        |
|   브라우저가 서버와의 연결을 열어둠 (HTTP/1.1 기본값)                 |
|                                                                       |
|   +---------------------------------------------------------------+   |
|   |  Browser Connection Pool                                      |   |
|   |                                                               |   |
|   |  example.com:                                                 |   |
|   |    +------+ +------+ +------+ +------+ +------+ +------+      |   |
|   |    |Conn 1| |Conn 2| |Conn 3| |Conn 4| |Conn 5| |Conn 6|      |   |
|   |    +------+ +------+ +------+ +------+ +------+ +------+      |   |
|   |                                                               |   |
|   |  api.example.com:                                             |   |
|   |    +------+ +------+ +------+ +------+ +------+ +------+      |   |
|   |    |Conn 1| |Conn 2| |Conn 3| |Conn 4| |Conn 5| |Conn 6|      |   |
|   |    +------+ +------+ +------+ +------+ +------+ +------+      |   |
|   |                                                               |   |
|   |  Typical limit: 6 connections per origin                      |   |
|   |  일반적인 제한: origin당 6개 연결                             |   |
|   +---------------------------------------------------------------+   |
|                                                                       |
+-----------------------------------------------------------------------+
```

### Database Connection Pooling (데이터베이스 연결 풀링)

```
+-----------------------------------------------------------------------+
|                    Database Connection Pool                            |
+-----------------------------------------------------------------------+
|                                                                       |
|   Application Server                       Database Server            |
|   +-----------------------------+         +-------------------+       |
|   |                             |         |                   |       |
|   |  Request Handler 1 --------|------+  |                   |       |
|   |  Request Handler 2 --------|---+  |  |                   |       |
|   |  Request Handler 3 --------|--+|  |  |                   |       |
|   |                             |  ||  |  |                   |       |
|   |  +----------------------+   |  ||  |  |   +-----------+   |       |
|   |  |   Connection Pool   |   |  ||  +--|-->| Connection|   |       |
|   |  |  +----+ +----+ +----+|  |  |+-----|-->| Connection|   |       |
|   |  |  |Conn| |Conn| |Conn||  |  +------|-->| Connection|   |       |
|   |  |  | 1  | | 2  | | 3  ||  |         |   +-----------+   |       |
|   |  |  +----+ +----+ +----+|  |         |                   |       |
|   |  +----------------------+   |         |                   |       |
|   |                             |         |                   |       |
|   +-----------------------------+         +-------------------+       |
|                                                                       |
|   Pool parameters:                                                    |
|   - Min connections (최소 연결)                                       |
|   - Max connections (최대 연결)                                       |
|   - Idle timeout (유휴 타임아웃)                                      |
|   - Connection timeout (연결 타임아웃)                                |
|                                                                       |
+-----------------------------------------------------------------------+
```

### Connection Pool Configuration (연결 풀 설정)

```
+-----------------------------------------------------------------------+
|                    Pool Configuration Example                          |
+-----------------------------------------------------------------------+
|                                                                       |
|   // Node.js with pg (PostgreSQL)                                     |
|   const pool = new Pool({                                             |
|     host: 'localhost',                                                |
|     database: 'mydb',                                                 |
|     max: 20,           // Maximum connections in pool                 |
|                        // 풀의 최대 연결 수                           |
|     min: 5,            // Minimum connections to maintain             |
|                        // 유지할 최소 연결 수                         |
|     idleTimeoutMillis: 30000,  // Close idle connections after 30s    |
|                                // 30초 후 유휴 연결 종료              |
|     connectionTimeoutMillis: 2000  // Wait 2s for connection          |
|                                    // 연결을 위해 2초 대기            |
|   });                                                                 |
|                                                                       |
+-----------------------------------------------------------------------+

+----------------------+------------------------------------------------+
| Parameter            | Description                                    |
+----------------------+------------------------------------------------+
| max                  | Maximum pool size (prevent overload)           |
|                      | 최대 풀 크기 (과부하 방지)                     |
+----------------------+------------------------------------------------+
| min                  | Minimum warm connections                       |
|                      | 최소 웜 연결 수                                |
+----------------------+------------------------------------------------+
| idleTimeout          | Close unused connections                       |
|                      | 사용하지 않는 연결 종료                        |
+----------------------+------------------------------------------------+
| connectionTimeout    | Max wait time for connection                   |
|                      | 연결 최대 대기 시간                            |
+----------------------+------------------------------------------------+
| maxLifetime          | Recycle connections periodically               |
|                      | 연결을 주기적으로 재활용                       |
+----------------------+------------------------------------------------+
```

### Connection Pool Best Practices (연결 풀 모범 사례)

```
+-----------------------------------------------------------------------+
|                    Connection Pool Best Practices                      |
+-----------------------------------------------------------------------+
|                                                                       |
|   1. Size the pool appropriately (풀 크기를 적절히 설정)              |
|   +---------------------------------------------------------------+   |
|   |   Too small: Requests queue, waiting for connections          |   |
|   |   너무 작음: 요청이 대기열에서 연결 대기                       |   |
|   |                                                               |   |
|   |   Too large: Wastes resources, may overwhelm database         |   |
|   |   너무 큼: 리소스 낭비, 데이터베이스 과부하 가능              |   |
|   |                                                               |   |
|   |   Rule of thumb: connections = (CPU cores * 2) + disk spindles|   |
|   |   경험 법칙: 연결 = (CPU 코어 * 2) + 디스크 스핀들            |   |
|   +---------------------------------------------------------------+   |
|                                                                       |
|   2. Always return connections to pool (항상 연결을 풀에 반환)        |
|   +---------------------------------------------------------------+   |
|   |   Use try-finally or connection managers                      |   |
|   |   try-finally 또는 연결 관리자 사용                           |   |
|   |                                                               |   |
|   |   try {                                                       |   |
|   |     conn = pool.getConnection();                              |   |
|   |     // use connection                                         |   |
|   |   } finally {                                                 |   |
|   |     conn.release();  // Always return!                        |   |
|   |   }                                                           |   |
|   +---------------------------------------------------------------+   |
|                                                                       |
|   3. Monitor pool metrics (풀 메트릭 모니터링)                        |
|   +---------------------------------------------------------------+   |
|   |   - Active connections                                        |   |
|   |   - Waiting requests                                          |   |
|   |   - Connection creation rate                                  |   |
|   |   - Timeout/error rate                                        |   |
|   +---------------------------------------------------------------+   |
|                                                                       |
|   4. Set appropriate timeouts (적절한 타임아웃 설정)                  |
|   +---------------------------------------------------------------+   |
|   |   - Connection timeout: fail fast if DB is down               |   |
|   |   - Idle timeout: reclaim unused connections                  |   |
|   |   - Max lifetime: prevent stale connections                   |   |
|   +---------------------------------------------------------------+   |
|                                                                       |
+-----------------------------------------------------------------------+
```

---

## 5. Summary (요약)

### Key Concepts (핵심 개념)

```
+-----------------------------------------------------------------------+
|                     Chapter 16 Summary                                 |
+-----------------------------------------------------------------------+
|                                                                       |
|  1. HTTP Caching (HTTP 캐싱)                                          |
|     - Cache-Control header: max-age, public, private, no-cache        |
|     - ETag for validation: If-None-Match, 304 Not Modified            |
|     - Cache invalidation: versioned URLs, content hashes              |
|     - Browser -> CDN -> Proxy -> Origin cache hierarchy               |
|                                                                       |
|  2. CDN (Content Delivery Network)                                    |
|     - Geographically distributed edge servers                         |
|     - Reduces latency by serving from nearby locations                |
|     - Cache HIT: serve from edge, Cache MISS: fetch from origin       |
|     - Benefits: speed, scalability, DDoS protection                   |
|                                                                       |
|  3. Compression (압축)                                                |
|     - gzip: widely supported, good compression                        |
|     - Brotli: better compression (15-25%), modern browsers            |
|     - Accept-Encoding / Content-Encoding headers                      |
|     - Pre-compress static assets, on-the-fly for dynamic              |
|                                                                       |
|  4. Connection Pooling (연결 풀링)                                    |
|     - Reuse connections to avoid setup overhead                       |
|     - HTTP Keep-Alive for browser connections                         |
|     - Database pools: min, max, idle timeout settings                 |
|     - Always return connections to pool                               |
|                                                                       |
+-----------------------------------------------------------------------+
```

### Performance Optimization Checklist (성능 최적화 체크리스트)

```
+-----------------------------------------------------------------------+
|                    Web Performance Checklist                           |
+-----------------------------------------------------------------------+
|                                                                       |
|   CACHING (캐싱):                                                     |
|   [x] Set appropriate Cache-Control headers                           |
|   [x] Use ETag or Last-Modified for validation                        |
|   [x] Version static assets (file hash in name)                       |
|   [x] Use no-cache for HTML, long max-age for static assets           |
|                                                                       |
|   CDN (CDN):                                                          |
|   [x] Serve static assets from CDN                                    |
|   [x] Configure appropriate TTLs on edge servers                      |
|   [x] Use cache purging for urgent updates                            |
|                                                                       |
|   COMPRESSION (압축):                                                 |
|   [x] Enable gzip/Brotli for text-based content                       |
|   [x] Pre-compress static assets                                      |
|   [x] Set minimum size threshold (1KB)                                |
|   [x] Don't compress already compressed content                       |
|                                                                       |
|   CONNECTIONS (연결):                                                 |
|   [x] Use HTTP/2 or HTTP/3 for multiplexing                           |
|   [x] Configure connection pools appropriately                        |
|   [x] Monitor pool metrics and adjust sizes                           |
|   [x] Always return connections to pools                              |
|                                                                       |
+-----------------------------------------------------------------------+
```

### Quick Reference Table (빠른 참조표)

```
+------------------+---------------------------+---------------------------+
| Technique        | Header/Setting            | Benefit                   |
+------------------+---------------------------+---------------------------+
| Browser Cache    | Cache-Control: max-age    | Eliminate requests        |
| 브라우저 캐시    |                           | 요청 제거                 |
+------------------+---------------------------+---------------------------+
| Validation       | ETag, If-None-Match       | Save bandwidth (304)      |
| 검증             |                           | 대역폭 절약               |
+------------------+---------------------------+---------------------------+
| CDN              | Edge caching              | Reduce latency            |
|                  |                           | 지연 시간 감소            |
+------------------+---------------------------+---------------------------+
| Compression      | Content-Encoding: gzip/br | Smaller transfer size     |
| 압축             |                           | 전송 크기 감소            |
+------------------+---------------------------+---------------------------+
| Keep-Alive       | Connection: keep-alive    | Reuse connections         |
|                  |                           | 연결 재사용               |
+------------------+---------------------------+---------------------------+
| Connection Pool  | min/max/timeout settings  | Reduce connection overhead|
| 연결 풀          |                           | 연결 오버헤드 감소        |
+------------------+---------------------------+---------------------------+
```

---

*End of Chapter 16*
